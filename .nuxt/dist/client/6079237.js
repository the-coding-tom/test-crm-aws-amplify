(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{320:function(e,t,o){"use strict";var r={props:{title:{type:String,default:""},subtitle:{type:String,default:""},info:{type:String,default:""}}},n=o(11),component=Object(n.a)(r,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("h1",{staticClass:"page-title"},[o("span",[e._v(e._s(e.title))]),e._v(" "),o("b",{directives:[{name:"show",rawName:"v-show",value:e.subtitle,expression:"subtitle"}]},[e._v("â€¢")]),e._v(" "+e._s(e.subtitle))])}),[],!1,null,null,null);t.a=component.exports},375:function(e,t,o){"use strict";(function(e){o(9),o(3),o(7),o(6),o(5),o(8),o(15),o(40);var r,n=o(12),l=o(0),m=(o(323),o(115),o(324)),c=o.n(m),d=(o(17),o(325),o(326)),f=o.n(d),h=o(116),k=o(320),v=o(481),_=o(42),w=o(117);function y(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(object);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,o)}return t}function B(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?y(Object(source),!0).forEach((function(t){Object(l.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):y(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}t.a={layout:"ShackDash",components:(r={BookingModal:v.a,BaseHeader:h.a,MainTitle:k.a},Object(l.a)(r,f.a.name,f.a),Object(l.a)(r,c.a.name,c.a),r),asyncData:function(e){return Object(n.a)(regeneratorRuntime.mark((function t(){var o,r,n,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.store,r=e.$membership,e.$resource,n=e.error,t.prev=1,t.next=4,o.dispatch("resources/getAllBookings");case 4:return t.next=6,o.dispatch("resources/getAllRooms");case 6:return"filter[status]=accepted&include=profile",t.next=9,r.getAllMemberships("filter[status]=accepted&include=profile").then((function(e){return{data:e.data}}));case 9:return t.abrupt("return",t.sent);case 12:t.prev=12,t.t0=t.catch(1),l=t.t0.response?t.t0.response.data.message:t.t0.message,n({statusCode:t.t0.statusCode,message:l});case 16:case"end":return t.stop()}}),t,null,[[1,12]])})))()},data:function(){return{processing:!1,loading:!1,searching:!1,newBooking:{from:null,to:null,title:null,membership_id:null,room_id:null,payment_method:null,card:null,source:null,purpose:"room-booking"},timePickerOptions:{start:"00:00",step:"00:15",end:"23:30"},calendarPlugin:"dayGridMonth,timeGridWeek",views:{listWeek:{noEventsMessage:"No bookings to display"}},bookdata:{from:null,to:null,title:null,membership_id:null,room_id:null,booking_id:null},modalText:"Add New Booking",showmodal:!0,modalUpdate:!1,disabledates:[],paymenttype:[{id:1,name:"card"},{id:2,name:"credit"}],payCards:[]}},computed:B(B(B({},Object(_.b)({allRooms:function(e){return e.resources.rooms.data},bookings:function(e){return e.resources.bookings},space:function(e){return e.space.currentSpace}})),Object(w.b)({from:"resources.addBooking.from",to:"resources.addBooking.to",title:"resources.addBooking.title",id:"resources.addBooking.id"})),{},{not_before:function(){return this.$moment().format("HH:mm")}}),created:function(){var e=this;this.bookings.map((function(t){e.disabledates.push(t.start),e.disabledates.push(t.end)}))},methods:{valueChange:function(e){this.newBooking.source=null},searchMembers:function(t){var link="filter[search]=".concat(t);this.loading=!this.loading;var o=this;e.debounce((function(){o.$membership.getAllMemberships(link).then((function(e){var data=e.data;o.loading=!o.loading,o.data=data}))}),350)()},searchResource:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function o(){var link;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return t.searching=!t.searching,link="/".concat(t.space.subdomain,"/admin/rooms/?search=").concat(e),o.next=4,t.$store.dispatch("resources/getAllRooms",link);case 4:t.searching=!t.searching;case 5:case"end":return o.stop()}}),o)})))()},eventClick:function(e){this.bookdata.from=this.$moment(e.start).format("YYYY-MM-DD HH:mm"),this.bookdata.to=this.$moment(e.end).format("YYYY-MM-DD HH:mm"),this.bookdata.title=e.title,this.bookdata.membership_id=e.extendedProps.extendProps.membership.id,this.bookdata.room_id=e.extendedProps.extendProps.room.id,this.bookdata.booking_id=e.extendedProps.extendProps.id,this.modalText="Update Booking",this.modalUpdate=!0,this.$bvModal.show("booking-modal")},bookDate:function(e){this.newBooking.from=this.$moment(e).format("YYYY-MM-DD HH:mm"),this.newBooking.to=this.$moment(e).add(1,"hour").format("YYYY-MM-DD HH:mm"),this.$bvModal.show("new-booking-modal")},dateChange:function(e){var data={from:this.$moment(e.startDate).format("YYYY-MM-DD"),to:this.$moment(e.endDate).format("YYYY-MM-DD")};this.$store.dispatch("resources/getAllBookingsByDate",data)},getRoomBook:function(e){this.$store.dispatch("resources/bookingsForARoom",e)},addBooking:function(){var e=this,t=this.newBooking;this.processing=!this.processing,this.$resource.bookRoomForMember(t.room_id,t).then((function(t){e.$bvToast.toast("Booking successful",{title:"Success",variant:"success"}),location.reload()})).catch((function(t){e.processing=!e.processing;var o=t.response?"".concat(t.response.data.message," ").concat(JSON.stringify(t.response.data.errors)):t.message;e.$bvToast.toast(o,{title:"Error",variant:"danger"})}))},submitBooking:function(e){var data={from:this.$moment(e.from).format("YYYY-MM-DD HH:mm"),to:this.$moment(e.to).format("YYYY-MM-DD HH:mm"),title:e.title,membership_id:e.membership_id,room_id:e.room_id,booking_id:this.bookdata.booking_id};if(this.$moment(data.to).diff(this.$moment(data.from))<9e5)return this.$bvToast.toast("Minimum booking duration should be 15 munites and above",{title:"Error",variant:"danger",solid:!0});this.modalUpdate&&this.bookdata.booking_id?this.updateBooking(data):(this.$store.dispatch("resources/createBooking",data),this.$bvModal.hide("booking-modal"))},cancelBook:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$resource.cancelRoomBooking(e.bookdata.booking_id);case 2:e.$bvToast.toast("Booking cancelled",{title:"Success",variant:"success"}),e.$bvModal.hide("booking-modal"),location.reload();case 5:case"end":return t.stop()}}),t)})))()},updateBooking:function(data){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("resources/updateRoomBooking",data);case 2:location.reload();case 3:case"end":return t.stop()}}),t)})))()},getPaymentMethods:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function o(){var r;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if("card"!=e){o.next=5;break}return o.next=3,t.$membership.getPaymentMethods(t.newBooking.membership_id);case 3:r=o.sent,t.payCards=r.data;case 5:case"end":return o.stop()}}),o)})))()}}}}).call(this,o(204))},376:function(e,t,o){"use strict";(function(e){o(17),o(15);t.a={props:{ifrom:{type:String,default:null},ito:{type:String,default:null},ititle:{type:String,default:null},imembership_id:{type:String,default:null},iroom_id:{type:String,default:null},disableddates:{type:Array,default:null}},data:function(){return{membership_id:"",from:"",to:"",title:"",members:[],rooms:[],room_id:"",timePickerOptions:{start:"00:00",step:"00:15",end:"23:30"}}},mounted:function(){this.from=this.ifrom?this.ifrom:this.$moment().format("YYYY-MM-DD HH:mm"),this.to=this.ito?this.ito:this.$moment().add(1,"hour").format("YYYY-MM-DD HH:mm"),this.title=this.ititle&&this.ititle,this.membership_id=this.imembership_id&&this.imembership_id,console.log(this.membership_id),this.room_id=this.iroom_id&&this.iroom_id,this.getConnectedMembers(),this.getRooms()},methods:{getConnectedMembers:function(){var t=this;this.$membership.getAllMembers("filter[status]=accepted&include=profile").then((function(data){console.log(data),t.members=e.map(data,(function(e){return{text:"".concat(e.first_name," ").concat(e.last_name),value:e.uuid}}))}))},getRooms:function(){var t=this;this.$resource.getAllRooms().then((function(o){var data=o.data;t.rooms=e.map(data.data,(function(e){return{text:e.name,value:e.id}}))}))},changeDate:function(e){this.to=this.$moment(e).add(1,"hour").format("YYYY-MM-DD HH:mm")},submitDetails:function(){var e=this.from,t=this.to,title=this.title,o=this.membership_id,r=this.room_id;this.$emit("details",{from:e,to:t,title:title,membership_id:o,room_id:r})},cancelBooking:function(){this.$emit("deleteBooking")}}}}).call(this,o(204))},377:function(e,t,o){},451:function(e,t,o){"use strict";var r=o(377);o.n(r).a},481:function(e,t,o){"use strict";var r=o(376).a,n=o(11),component=Object(n.a)(r,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("b-form",{on:{submit:function(t){return t.preventDefault(),e.submitDetails(t)}}},[o("b-row",[o("b-form-group",{staticClass:"col-md-12",attrs:{label:"Member"}},[o("b-form-select",{attrs:{options:e.members,value:e.membership_id,required:""},model:{value:e.membership_id,callback:function(t){e.membership_id=t},expression:"membership_id"}})],1)],1),e._v(" "),o("b-row",[o("b-form-group",{staticClass:"col-md-12",attrs:{label:"Room"}},[o("b-form-select",{attrs:{options:e.rooms,value:e.room_id,required:""},model:{value:e.room_id,callback:function(t){e.room_id=t},expression:"room_id"}})],1)],1),e._v(" "),o("b-row",[o("b-form-group",{staticClass:"col-md-6",attrs:{label:"From"}},[o("client-only",[o("date-picker",{attrs:{id:"time","time-picker-options":e.timePickerOptions,"disabled-days":e.disableddates,width:"100%","input-class":"form-control",lang:"en",format:"YYYY-MM-DD HH:mm","value-type":"format",confirm:"",type:"datetime"},on:{change:e.changeDate},model:{value:e.from,callback:function(t){e.from=t},expression:"from"}})],1)],1),e._v(" "),o("b-form-group",{staticClass:"col-md-6",attrs:{label:"To"}},[o("client-only",[o("date-picker",{attrs:{id:"time","time-picker-options":e.timePickerOptions,"disabled-days":e.disableddates,width:"100%","input-class":"form-control",lang:"en",format:"YYYY-MM-DD HH:mm","value-type":"format",confirm:"",type:"datetime"},model:{value:e.to,callback:function(t){e.to=t},expression:"to"}})],1)],1)],1),e._v(" "),o("b-row",[o("b-form-group",{staticClass:"col-md-12",attrs:{label:"Title"}},[o("b-form-input",{attrs:{placeholder:"Reason for booking",required:""},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1)],1),e._v(" "),o("b-row",[o("b-form-group",{staticClass:"col-md-12"},[o("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Save")]),e._v(" "),o("b-button",{staticClass:"float-right",attrs:{type:"button",variant:"default"},on:{click:e.cancelBooking}},[e._v("Cancel Booking")])],1)],1)],1)],1)}),[],!1,null,null,null);t.a=component.exports},554:function(e,t,o){"use strict";o.r(t);var r=o(375).a,n=(o(451),o(11)),component=Object(n.a)(r,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("base-header",{staticClass:"pb-6",attrs:{type:""}},[o("div",{staticClass:"d-flex justify-content-between align-items-center py-4"},[o("MainTitle",{attrs:{title:"Bookings",subtitle:"Calendar"}}),e._v(" "),o("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.new-booking-modal",modifiers:{"new-booking-modal":!0}}],attrs:{id:"modal-btn",variant:"primary"}},[e._v("Add New Booking")])],1)]),e._v(" "),o("div",{staticClass:"container-fluid mt--6"},[o("div",{staticClass:"card-deck flex-column flex-xl-row"},[o("card",[e.showmodal?o("b-modal",{attrs:{id:"booking-modal",title:e.modalText,"hide-footer":""}},[o("booking-modal",{attrs:{ifrom:e.bookdata.from,ito:e.bookdata.to,ititle:e.bookdata.title,imembership_id:e.bookdata.membership_id,iroom_id:e.bookdata.room_id,disableddates:e.disabledates},on:{details:e.submitBooking,deleteBooking:e.cancelBook}})],1):e._e(),e._v(" "),o("b-modal",{attrs:{id:"new-booking-modal","hide-footer":"",title:"Add New Booking"}},[o("b-form",{on:{submit:function(t){return t.preventDefault(),e.addBooking(t)}}},[o("b-row",[o("b-form-group",{staticClass:"col-md-12",attrs:{label:"Member"}},[o("el-select",{attrs:{"remote-method":e.searchMembers,loading:e.loading,required:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"Choose a member"},on:{change:e.valueChange},model:{value:e.newBooking.membership_id,callback:function(t){e.$set(e.newBooking,"membership_id",t)},expression:"newBooking.membership_id"}},e._l(e.data,(function(option){return o("el-option",{key:option.id,attrs:{label:option.first_name+" "+option.last_name,value:option.id}})})),1)],1),e._v(" "),o("b-form-group",{staticClass:"col-md-12",attrs:{label:"Resource to book"}},[o("el-select",{attrs:{"remote-method":e.searchResource,loading:e.searching,required:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"Choose a resource"},model:{value:e.newBooking.room_id,callback:function(t){e.$set(e.newBooking,"room_id",t)},expression:"newBooking.room_id"}},e._l(e.allRooms,(function(option){return o("el-option",{key:option.id,attrs:{label:option.name,value:option.id}})})),1)],1),e._v(" "),o("b-form-group",{staticClass:"col-md-12",attrs:{label:"Choose payment type"}},[o("el-select",{attrs:{disabled:!e.newBooking.membership_id,required:"",placeholder:"Choose payment type"},on:{change:e.getPaymentMethods},model:{value:e.newBooking.source,callback:function(t){e.$set(e.newBooking,"source",t)},expression:"newBooking.source"}},e._l(e.paymenttype,(function(option){return o("el-option",{key:option.id,attrs:{label:option.name,value:option.name}})})),1)],1),e._v(" "),"card"==e.newBooking.source?o("b-form-group",{staticClass:"col-md-12",attrs:{label:"Choose card"}},[o("el-select",{attrs:{required:"",placeholder:"Choose card"},model:{value:e.newBooking.payment_method,callback:function(t){e.$set(e.newBooking,"payment_method",t)},expression:"newBooking.payment_method"}},e._l(e.payCards,(function(option){return o("el-option",{key:option.id,attrs:{label:option.card_brand,value:option.id}})})),1)],1):e._e(),e._v(" "),o("b-form-group",{staticClass:"col-md-6",attrs:{label:"From"}},[o("client-only",[o("date-picker",{attrs:{id:"time","time-picker-options":e.timePickerOptions,"not-before":e.not_before,"disabled-days":e.disabledates,width:"100%","input-class":"form-control",lang:"en",format:"YYYY-MM-DD HH:mm","value-type":"format",confirm:"",type:"time"},model:{value:e.newBooking.from,callback:function(t){e.$set(e.newBooking,"from",t)},expression:"newBooking.from"}})],1)],1),e._v(" "),o("b-form-group",{staticClass:"col-md-6",attrs:{label:"To"}},[o("client-only",[o("date-picker",{attrs:{id:"time","time-picker-options":e.timePickerOptions,"not-before":e.not_before,"disabled-days":e.disabledates,width:"100%","input-class":"form-control",lang:"en",format:"YYYY-MM-DD HH:mm","value-type":"format",confirm:"",type:"time"},model:{value:e.newBooking.to,callback:function(t){e.$set(e.newBooking,"to",t)},expression:"newBooking.to"}})],1)],1),e._v(" "),o("b-form-group",{staticClass:"col-md-12",attrs:{label:"Title for Booking"}},[o("b-form-input",{attrs:{type:"text",placeholder:"Title for booking",required:""},model:{value:e.newBooking.title,callback:function(t){e.$set(e.newBooking,"title",t)},expression:"newBooking.title"}})],1)],1),e._v(" "),o("b-button",{attrs:{disabled:e.processing,type:"submit",variant:"primary"}},[e._v("Book")])],1)],1),e._v(" "),o("client-only",[o("full-calendar",{attrs:{events:e.bookings,views:e.views,right:e.calendarPlugin,"default-view":"timeGridWeek"},on:{eventClick:e.eventClick,dateClick:e.bookDate,dateChange:e.dateChange}})],1)],1)],1)])],1)}),[],!1,null,null,null);t.default=component.exports}}]);