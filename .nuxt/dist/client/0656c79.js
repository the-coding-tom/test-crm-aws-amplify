(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{322:function(e,t,n){"use strict";var r={props:{title:{type:String,default:""},subtitle:{type:String,default:""},info:{type:String,default:""}}},l=n(11),component=Object(l.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("h1",{staticClass:"page-title"},[n("span",[e._v(e._s(e.title))]),e._v(" "),n("b",{directives:[{name:"show",rawName:"v-show",value:e.subtitle,expression:"subtitle"}]},[e._v("â€¢")]),e._v(" "+e._s(e.subtitle))])}),[],!1,null,null,null);t.a=component.exports},362:function(e,t,n){"use strict";(function(e){n(9),n(3),n(7),n(6),n(5),n(8);var r=n(1),l=(n(17),n(15),n(40),n(12)),o=n(322),c=n(406),d=n(476);function h(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function m(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):h(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}t.a={layout:"ShackDash",components:{MainTitle:o.a,ChangePlan:c.a,ChangePlanBulk:d.a},data:function(){return{loading:!1,data:null,card:null,cards:[],perPage:10,items:[],currentPage:1,dropdown:"All",days:[30,15,5],plan_id:null,membership_id:null,id:null,selectedRows:[],fields:["_","full_name","plan","start_date","end_date","renewal","__"]}},computed:{rows:function(){return this.items.length}},watch:{$route:function(e,t){!e.query.membership_id&&t.query.membership_id&&(this.plan_id=null)}},asyncData:function(t){return Object(l.a)(regeneratorRuntime.mark((function n(){var r,l,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.error,l=t.$membership,!(o=t.route).query.plan){n.next=5;break}return n.next=4,l.subscribedToPlan(o.query.plan).then((function(data){return{data:data,items:e.map(data,(function(e){return{id:e.id,full_name:"".concat(e.user.first_name," ").concat(e.user.last_name),plan:e.plan.name,plan_id:e.plan.id,slug:e.slug,start_date:e.starts_at,end_date:e.ends_at,renewal:"manual-active"==e.state?"Do not auto renew":"auto renew",membership_id:e.user.uuid}})),viewing_plan_susbcriptions:!0,plan_name:o.query.name}})).catch((function(e){var t=e.response?"".concat(e.response.data.message," ~ ").concat(JSON.stringify(e.response.data.errors)):e.message;r({statusCode:e.statusCode,message:t})}));case 4:return n.abrupt("return",n.sent);case 5:return n.next=7,l.expiringSubscriptions(30).then((function(data){return{data:data,items:e.map(data,(function(e){return{id:e.id,full_name:"".concat(e.user.first_name," ").concat(e.user.last_name),plan:e.plan.name,plan_id:e.plan.id,slug:e.slug,start_date:e.starts_at,end_date:e.ends_at,renewal:"manual-active"==e.state?"Do not auto renew":"auto renew",membership_id:e.user.uuid}}))}})).catch((function(e){var t=e.response?"".concat(e.response.data.message," ~ ").concat(JSON.stringify(e.response.data.errors)):e.message;r({statusCode:e.statusCode,message:t})}));case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}}),n)})))()},methods:{handleClick:function(t){var n=this;this.dropdown=t,this.loading=!this.loading,this.$membership.expiringSubscriptions(t).then((function(data){n.loading=!n.loading,n.items=e.map(data,(function(e){return{id:e.id,full_name:"".concat(e.user.first_name," ").concat(e.user.last_name),plan:e.plan.name,plan_id:e.plan.id,slug:e.slug,start_date:e.starts_at,end_date:e.ends_at,renewal:"manual-active"==e.state?"Do not auto renew":"auto renew",membership_id:e.user.uuid}}))})).catch((function(e){n.loading=!n.loading;var t=e.response?"".concat(e.response.data.message," ~ ").concat(JSON.stringify(e.response.data.errors)):e.message;error({statusCode:e.statusCode,message:t})}))},showForm:function(t){var n=this;this.data=t,this.$bvModal.show("renew"),this.$membership.getPaymentMethods(t.item.membership_id).then((function(t){var data=t.data;n.cards=e.map(data,(function(e){return{value:e.id,text:"".concat(e.card_brand," - **** ").concat(e.last_4)}}))})).catch((function(e){var t=e.response?"".concat(e.response.data.message," ~ ").concat(JSON.stringify(e.response.data.errors)):e.message;n.$bvToast.toast(t,{variant:"danger",title:"Error"})}))},beginRenew:function(){var e={plan_id:this.data.item.plan_id,card_nonce:this.card,slug:this.data.item.slug};this.renewSubscription(this.data.item.membership_id,e)},renewSubscription:function(e,t){var n=this;this.$membership.renewSubscription(e,t).then((function(e){e&&(n.items.splice(n.data.index,1),n.$bvToast.toast("".concat(e.data.first_name," ").concat(e.data.last_name,"'s subscription renewed successfully"),{variant:"success",title:"Success"}),n.$bvModal.hide("renew"))})).catch((function(e){var t=e.response?"".concat(e.response.data.message," ~ ").concat(JSON.stringify(e.response.data.errors)):e.message;n.$bvToast.toast(t,{variant:"danger",title:"Error"})}))},upgradeForMember:function(data){m({},this.$route.query);var e=data.item,t=e.membership_id,n=e.id;this.plan_id=n,this.membership_id=t,this.$bvModal.show("change-plan")},onChangePlanModalClosed:function(){var e=m({},this.$route.query);delete e.membership_id,this.$router.push({query:e}),this.plan_id=null},onMemberSelected:function(e,data){var t=data.item,n={membership_id:t.membership_id,subscription_id:t.id};if(e)this.selectedRows.push(n);else{var r=this.selectedRows.indexOf(n);this.selectedRows.splice(r,1)}},upgradeBulkMembers:function(data){this.$bvModal.show("change-plan-for-bulk")}}}}).call(this,n(206))},363:function(e,t,n){},406:function(e,t,n){"use strict";n(14);var r,l=n(1),o=(n(325),n(116),n(326)),c=n.n(o),d=(n(17),n(327),n(328)),h=n.n(d),m={name:"ChangePlan",components:(r={},Object(l.a)(r,h.a.name,h.a),Object(l.a)(r,c.a.name,c.a),r),props:{plan_id:Number,membership_id:{type:String,default:""}},data:function(){return{loading:!1,search:"",plans:[],new_plan_id:"",change:{dueDate:null,changeInstantly:!0}}},mounted:function(){var e=this;this.loading=!this.loading,this.$plan.getAllPlan().then((function(t){var data=t.data;e.loading=!e.loading,e.plans=data.data})).catch((function(t){e.loading=!e.loading,e.$bvToast.toast("Failed to retrieve plans. Try again",{title:"Error",variant:"danger"})}))},methods:{getPlans:function(q){var e=this;this.loading=!this.loading;var link="".concat(this.$route.params.space,"/plans?filter[name]=").concat(q);this.$plan.getAllPlan(link).then((function(t){var data=t.data;e.loading=!e.loading,e.plans=data.data})).catch((function(t){e.loading=!e.loading,e.$bvToast.toast("Failed to retrieve plans. Try again",{title:"Error",variant:"danger"})}))},changePlan:function(){var e,t=this;this.loading=!this.loading,e=this.membership_id?this.membership_id:this.$route.params.id;var r=this.new_plan_id,l=this.plan_id,o=this.change,c=n(42);this.$membership.changePlan(e,{subscription_id:l,new_plan_id:r,due_date:o.dueDate||c(),scheduled:!this.change.changeInstantly,new_plan_name:""}).then((function(e){e.data;t.onPlanChangedSuccessfully()})).catch((function(e){t.loading=!t.loading;var n=e.response?"".concat(e.response.data.message," ~ ").concat(JSON.stringify(e.response.data.errors)):e.message;t.$bvToast.toast(n,{title:"Error",variant:"danger"})}))},onPlanChangedSuccessfully:function(){this.$bvToast.toast("Plan changed successfully",{title:"Success",variant:"success"}),location.reload()}}},f=n(11),component=Object(f.a)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-form",{on:{submit:function(t){return t.preventDefault(),e.changePlan(t)}}},[n("b-row",[n("b-form-group",{staticClass:"col-md-12",attrs:{label:"New Plan",description:""}},[n("el-select",{attrs:{"remote-method":e.getPlans,loading:e.loading,filterable:"",remote:"","reserve-keyword":"",placeholder:"Choose New Plan"},model:{value:e.new_plan_id,callback:function(t){e.new_plan_id=t},expression:"new_plan_id"}},e._l(e.plans,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),n("b-form-group",{staticClass:"col-md-6",attrs:{label:"Change instantly"}},[n("b-form-checkbox",{attrs:{value:!0,"unchecked-value":!1},model:{value:e.change.changeInstantly,callback:function(t){e.$set(e.change,"changeInstantly",t)},expression:"change.changeInstantly"}},[e._v("Yes")])],1),e._v(" "),e.change.changeInstantly?e._e():n("b-form-group",{staticClass:"col-md-12",attrs:{id:"selectPlan",label:"Change on",description:""}},[n("el-input",{attrs:{"remote-method":e.getPlans,loading:e.loading,type:"date",filterable:"",remote:"","reserve-keyword":"",required:"",placeholder:"Due Date"},model:{value:e.change.dueDate,callback:function(t){e.$set(e.change,"dueDate",t)},expression:"change.dueDate"}})],1)],1),e._v(" "),n("b-button",{staticClass:"float-right",attrs:{disabled:e.loading,type:"submit",variant:"primary"}},[e._v("Update Plan")])],1)],1)}),[],!1,null,null,null);t.a=component.exports},450:function(e,t,n){"use strict";var r=n(363);n.n(r).a},476:function(e,t,n){"use strict";n(14);var r,l=n(1),o=(n(325),n(116),n(326)),c=n.n(o),d=(n(17),n(327),n(328)),h=n.n(d),m={name:"ChangePlanForBulkMembership",components:(r={},Object(l.a)(r,h.a.name,h.a),Object(l.a)(r,c.a.name,c.a),r),props:{subscriber_data:Number},data:function(){return{loading:!1,search:"",plans:[],new_plan_id:"",change:{dueDate:null,changeInstantly:!0}}},mounted:function(){var e=this;this.loading=!this.loading,this.$plan.getAllPlan().then((function(t){var data=t.data;e.loading=!e.loading,e.plans=data.data})).catch((function(t){e.loading=!e.loading,e.$bvToast.toast("Failed to retrieve plans. Try again",{title:"Error",variant:"danger"})}))},methods:{getPlans:function(q){var e=this;this.loading=!this.loading;var link="".concat(this.$route.params.space,"/plans?filter[name]=").concat(q);this.$plan.getAllPlan(link).then((function(t){var data=t.data;e.loading=!e.loading,e.plans=data.data})).catch((function(t){e.loading=!e.loading,e.$bvToast.toast("Failed to retrieve plans. Try again",{title:"Error",variant:"danger"})}))},changePlan:function(){var e=this;this.loading=!this.loading;var t=this.new_plan_id,n=this.change;this.$membership.changePlanBulk({subscriber_data:this.subscriber_data,new_plan_id:t,due_date:n.dueDate}).then((function(t){t.data;e.onPlanChangedSuccessfully()})).catch((function(t){e.loading=!e.loading;var n=t.response?"".concat(t.response.data.message," ~ ").concat(JSON.stringify(t.response.data.errors)):t.message;e.$bvToast.toast(n,{title:"Error",variant:"danger"})}))},onPlanChangedSuccessfully:function(){this.$bvToast.toast("Plan changed successfully",{title:"Success",variant:"success"}),location.reload()}}},f=n(11),component=Object(f.a)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-form",{on:{submit:function(t){return t.preventDefault(),e.changePlan(t)}}},[n("b-row",[n("b-form-group",{staticClass:"col-md-12",attrs:{label:"New Plan",description:""}},[n("el-select",{attrs:{"remote-method":e.getPlans,loading:e.loading,filterable:"",remote:"","reserve-keyword":"",placeholder:"Choose New Plan"},model:{value:e.new_plan_id,callback:function(t){e.new_plan_id=t},expression:"new_plan_id"}},e._l(e.plans,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),n("b-form-group",{staticClass:"col-md-6",attrs:{label:"Change instantly"}},[n("b-form-checkbox",{attrs:{value:!0,"unchecked-value":!1},model:{value:e.change.changeInstantly,callback:function(t){e.$set(e.change,"changeInstantly",t)},expression:"change.changeInstantly"}},[e._v("Yes")])],1),e._v(" "),e.change.changeInstantly?e._e():n("b-form-group",{staticClass:"col-md-12",attrs:{id:"selectPlan",label:"Change on",description:""}},[n("el-input",{attrs:{"remote-method":e.getPlans,loading:e.loading,type:"date",filterable:"",remote:"","reserve-keyword":"",required:"",placeholder:"Due Date"},model:{value:e.change.dueDate,callback:function(t){e.$set(e.change,"dueDate",t)},expression:"change.dueDate"}})],1)],1),e._v(" "),n("b-button",{staticClass:"float-right",attrs:{disabled:e.loading,type:"submit",variant:"primary"}},[e._v("Update Plan")])],1)],1)}),[],!1,null,null,null);t.a=component.exports},556:function(e,t,n){"use strict";n.r(t);var r=n(362).a,l=(n(450),n(11)),component=Object(l.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("base-header",{staticClass:"pb-6",attrs:{type:""}},[n("div",{staticClass:"d-flex justify-content-between align-items-center py-4"},[n("MainTitle",{attrs:{subtitle:e.viewing_plan_susbcriptions?e.plan_name:"Expiring Memberships",title:e.viewing_plan_susbcriptions?"Plans":"Expiring Memberships"}}),e._v(" "),n("b-dropdown",{staticClass:"m-md-2",attrs:{id:"dropdown-1",text:"More options"},on:{click:e.handleClick}},[n("b-dropdown-item",{attrs:{disabled:!(e.selectedRows.length>0)},on:{click:function(t){return e.upgradeBulkMembers()}}},[e._v("change plan")]),e._v(" "),n("b-dropdown-item",{attrs:{disabled:!(e.selectedRows.length>0)}},[e._v("renew")]),e._v(" "),n("b-dropdown-item",{attrs:{disabled:!(e.selectedRows.length>0)}},[e._v("delete")]),e._v(" "),n("b-dropdown-divider")],1)],1)]),e._v(" "),n("div",{staticClass:"container-fluid mt--6"},[n("card",[n("b-table",{attrs:{busy:e.loading,items:e.items,fields:e.fields,"show-empty":"",striped:"",hover:""},scopedSlots:e._u([{key:"cell(_)",fn:function(t){return[n("b-form-checkbox",{attrs:{value:!0,"unchecked-value":!1},on:{change:function(n){return e.onMemberSelected(n,t)}},model:{value:t.rowSelected,callback:function(n){e.$set(t,"rowSelected",n)},expression:"row.rowSelected"}})]}},{key:"cell(full_name)",fn:function(t){return[n("nuxt-link",{attrs:{to:{name:"space-directory-id",params:{id:t.item.membership_id}}}},[e._v("\n            "+e._s(t.item.full_name))])]}},{key:"cell(__)",fn:function(data){return[n("b-button",{staticClass:"text-primary",attrs:{variant:"transparent",small:""},on:{click:function(t){return e.showForm(data)}}},[n("i",{staticClass:"fas fa-undo-alt"}),e._v(" Renew")]),e._v(" "),n("b-button",{staticClass:"btn btn-primary",staticStyle:{color:"white"},on:{click:function(t){return e.upgradeForMember(data)}}},[e._v("\n            Change Plan\n          ")])]}}])}),e._v(" "),n("b-pagination",{staticClass:"text-center",attrs:{"total-rows":e.rows,"per-page":e.perPage,align:"center","aria-controls":"my-table"},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}})],1)],1),e._v(" "),n("b-modal",{attrs:{id:"renew",title:"Renew Subscription","hide-footer":""}},[n("b-form",{on:{submit:function(t){return t.preventDefault(),e.beginRenew(t)}}},[n("b-form-group",{attrs:{label:"Payment Source",description:"Card to charge for this transaction"}},[n("b-form-select",{attrs:{options:e.cards,required:""},model:{value:e.card,callback:function(t){e.card=t},expression:"card"}},[n("option",{domProps:{value:null}},[e._v("Choose a payment card")])])],1),e._v(" "),n("b-form-group",[n("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Renew")])],1)],1)],1),e._v(" "),n("b-modal",{attrs:{id:"change-plan",title:"Change Current Plan","hide-footer":""},on:{hidden:e.onChangePlanModalClosed}},[n("ChangePlan",{attrs:{plan_id:e.plan_id,membership_id:e.membership_id}})],1),e._v(" "),n("b-modal",{attrs:{id:"change-plan-for-bulk",title:"Change Current Plan","hide-footer":""},on:{hidden:e.onChangePlanModalClosed}},[n("ChangePlanBulk",{attrs:{subscriber_data:e.selectedRows}})],1)],1)}),[],!1,null,null,null);t.default=component.exports}}]);